
[2025-11-29T14:16:06.179Z] Creating incident. Body: {"club_id":91,"club_reference":"TestRef123","reporter_id":10,"local_office_id":1,"owner_id":12182,"ship_id":19406,"incident_date":"2025-11-29","type_id":62,"local_agent_id":628,"status":"Open","voyage_and_leg":"Test Voyage","member_id":12182,"description":"Test Incident","reporting_date":"2025-11-29","place_id":368,"handler_id":32}
Calculating ref for year: 2025, office: 1
Calculated next_ref: 660 (Type: number)

[2025-11-29T14:26:44.430Z] Creating incident. Body: {"club_id":91,"club_reference":"TestRef123","reporter_id":10,"local_office_id":1,"owner_id":12182,"ship_id":19406,"incident_date":"2025-11-29","type_id":62,"local_agent_id":628,"status":"Open","voyage_and_leg":"Test Voyage","member_id":12182,"description":"Test Incident Fix","reporting_date":"2025-11-29","place_id":368,"handler_id":32}
Calculating ref for year: 2025, office: 1
Calculated next_ref: 660 (Type: number)

[2025-11-29T14:32:22.721Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"16920","member_id":"11765","owner_id":"11765","club_id":"3","handler_id":"20","local_office_id":"2","type_id":"7","reporter_id":"5","local_agent_id":"401","place_id":"3","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-27","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-29","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 40 (Type: number)

[2025-11-29T14:36:22.324Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"16920","member_id":"11765","owner_id":"11765","club_id":"3","handler_id":"20","local_office_id":"2","type_id":"7","reporter_id":"5","local_agent_id":"401","place_id":"3","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-27","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-29","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 40 (Type: number)

[2025-11-29T14:36:59.886Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"16193","member_id":"6","owner_id":"6","club_id":"2","handler_id":"34","local_office_id":"2","type_id":"78","reporter_id":"1","local_agent_id":"2","place_id":"613","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-29","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-29","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 40 (Type: number)

[2025-11-29T14:38:54.163Z] Creating incident. Body: {"incident_date":"2025-11-29","member_id":"6","time_bar_date":"2026-11-29","handler_id":"34","club_id":"2","club_reference":"","estimated_disposal_date":"","description":"","reporter_id":"1","voyage_and_leg":"","local_agent_id":"2","berthing_date":"2025-11-29","latest_report_date":"","next_review_date":"2025-11-30","closing_date":"","status":"OPEN","type_id":"78","ship_id":"16193","local_office_id":"2","owner_id":"6","place_id":"613","reporting_date":"2025-11-29"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 40 (Type: number)
Error creating incident: Validation failed for parameter 'closing_date'. Invalid date.
Stack: RequestError: Validation failed for parameter 'closing_date'. Invalid date.
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:449:19
    at Array.forEach (<anonymous>)
    at Request.userCallback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:446:46)
    at Request.callback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\request.js:205:14)
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\connection.js:1705:17
    at process.processTicksAndRejections (node:internal/process/task_queues:84:11)

[2025-11-29T14:40:44.458Z] Creating incident. Body: {"incident_date":"2025-11-29","member_id":"6","time_bar_date":"2026-11-29","handler_id":"34","club_id":"2","club_reference":"","estimated_disposal_date":"","description":"","reporter_id":"1","voyage_and_leg":"","local_agent_id":"2","berthing_date":"2025-11-29","latest_report_date":"","next_review_date":"2025-11-30","closing_date":"","status":"OPEN","type_id":"78","ship_id":"16193","local_office_id":"2","owner_id":"6","place_id":"613","reporting_date":"2025-11-29"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 40 (Type: number)

[2025-11-29T14:42:42.718Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"13475","member_id":"2","owner_id":"2","club_id":"2","handler_id":"20","local_office_id":"3","type_id":"12","reporter_id":"3","local_agent_id":"6","place_id":"613","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-30","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-29","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 3
Calculated next_ref: 38 (Type: number)

[2025-11-29T14:48:50.887Z] Creating incident. Body: {"incident_date":"2025-11-29","member_id":"6","time_bar_date":"2026-11-29","handler_id":"34","club_id":"2","club_reference":"","estimated_disposal_date":"","description":"Test Fix ID Return PS","reporter_id":"1","voyage_and_leg":"","local_agent_id":"2","berthing_date":"2025-11-29","latest_report_date":"","next_review_date":"2025-11-30","closing_date":"","status":"OPEN","type_id":"78","ship_id":"16193","local_office_id":"2","owner_id":"6","place_id":"613","reporting_date":"2025-11-29"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 41 (Type: number)
Error fetching incident undefined: Validation failed for parameter 'id'. Invalid number.
Stack: RequestError: Validation failed for parameter 'id'. Invalid number.
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:449:19
    at Array.forEach (<anonymous>)
    at Request.userCallback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:446:46)
    at Request.callback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\request.js:205:14)
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\connection.js:1705:17
    at process.processTicksAndRejections (node:internal/process/task_queues:84:11)
Error fetching incident undefined: Validation failed for parameter 'id'. Invalid number.
Stack: RequestError: Validation failed for parameter 'id'. Invalid number.
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:449:19
    at Array.forEach (<anonymous>)
    at Request.userCallback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:446:46)
    at Request.callback (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\request.js:205:14)
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\connection.js:1705:17
    at process.processTicksAndRejections (node:internal/process/task_queues:84:11)

[2025-11-29T14:50:47.193Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"1","member_id":"2","owner_id":"2","club_id":"4","handler_id":"20","local_office_id":"2","type_id":"2","reporter_id":"4","local_agent_id":"3","place_id":"3","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-30","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-29","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 42 (Type: number)

[2025-11-29T14:54:17.636Z] Creating incident. Body: {"incident_date":"2025-11-29","member_id":"6","time_bar_date":"","handler_id":"34","club_id":"2","club_reference":"","estimated_disposal_date":"","description":"Test Minimal Fields PS","reporter_id":"1","voyage_and_leg":"","local_agent_id":"2","berthing_date":"2025-11-29","latest_report_date":"","next_review_date":"","closing_date":"","status":"OPEN","type_id":"78","ship_id":"16193","local_office_id":"2","owner_id":"6","place_id":"613","reporting_date":"2025-11-29"}
Calculating ref for year: 2025, office: 2
Calculated next_ref: 43 (Type: number)

[2025-11-29T14:56:15.801Z] Creating incident. Body: {"incident_date":"2025-11-29","status":"OPEN","description":"","ship_id":"16143","member_id":"10015","owner_id":"10015","club_id":"71","handler_id":"32","local_office_id":"1","type_id":"2","reporter_id":"4","local_agent_id":"6","place_id":"2","closing_date":"","estimated_disposal_date":"","berthing_date":"2025-11-11","voyage_and_leg":"","club_reference":"","reporting_date":"2025-11-13","time_bar_date":"2026-11-29","latest_report_date":"","next_review_date":"2025-11-30"}
Calculating ref for year: 2025, office: 1
Calculated next_ref: 661 (Type: number)

[2025-11-29T14:58:32.894Z] Creating sub-incident for ID: 102900
Found parent incident: {"id":"102900","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":1,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}

[2025-11-29T15:00:54.113Z] Creating sub-incident for ID: 102901
Found parent incident: {"id":"102901","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":2,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 3
Attempting to insert sub-incident...

[2025-11-29T15:02:03.278Z] Creating sub-incident for ID: 102902
Found parent incident: {"id":"102902","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":3,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 4
Attempting to insert sub-incident...

[2025-11-29T15:06:04.652Z] Creating sub-incident for ID: 102903
Found parent incident: {"id":"102903","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":4,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 5
Attempting to insert sub-incident...
Error creating sub-incident: Incorrect syntax near '@club_reference'.
Stack: RequestError: Incorrect syntax near '@club_reference'.
    at handleError (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\mssql\lib\tedious\request.js:384:15)
    at Connection.emit (node:events:508:28)
    at Connection.emit (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\connection.js:1040:18)
    at RequestTokenHandler.onErrorMessage (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\token\handler.js:365:21)
    at Readable.<anonymous> (C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\node_modules\tedious\lib\token\token-stream-parser.js:26:33)
    at Readable.emit (node:events:508:28)
    at addChunk (node:internal/streams/readable:559:12)
    at readableAddChunkPushObjectMode (node:internal/streams/readable:536:3)
    at Readable.push (node:internal/streams/readable:391:5)
    at nextAsync (node:internal/streams/from:194:22)

[2025-11-29T15:07:46.364Z] Creating sub-incident for ID: 102903
Found parent incident: {"id":"102903","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":4,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 5
Attempting to insert sub-incident...
Sub-incident created with ID: 102904

[2025-11-29T15:09:30.726Z] Creating sub-incident for ID: 102904
Found parent incident: {"id":"102904","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":5,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 6
Attempting to insert sub-incident...
Sub-incident created with ID: 102905

[2025-11-29T15:10:36.639Z] Creating sub-incident for ID: 102905
Found parent incident: {"id":"102905","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":6,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 7
Attempting to insert sub-incident...
Sub-incident created with ID: 102906

[2025-11-29T15:10:55.581Z] Creating sub-incident for ID: 102906
Found parent incident: {"id":"102906","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":7,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 8
Attempting to insert sub-incident...
Sub-incident created with ID: 102907

[2025-11-29T15:10:58.712Z] Creating sub-incident for ID: 102907
Found parent incident: {"id":"102907","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":8,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 9
Attempting to insert sub-incident...
Sub-incident created with ID: 102908

[2025-11-29T15:13:25.657Z] Creating sub-incident for ID: 102907
Found parent incident: {"id":"102907","berthing_date":"2025-11-11T00:00:00.000Z","closing_date":null,"club_reference":"","description":"","effective_disposal_date":null,"estimated_disposal_date":null,"incident_date":"2025-11-29T00:00:00.000Z","latest_report_date":null,"next_review_date":"2025-11-30T00:00:00.000Z","reference_number":661,"reference_sub_number":8,"reference_year":2025,"reporting_date":"2025-11-13T00:00:00.000Z","status":"OPEN","time_bar_date":"2026-11-29T00:00:00.000Z","voyage_and_leg":"","club_id":"71","handler_id":"32","local_agent_id":"6","local_office_id":"1","member_id":"10015","owner_id":"10015","place_id":"2","reporter_id":"4","ship_id":"16143","type_id":"2","created_by_user":null,"created_date":null,"last_modified_by_user":null,"last_modified_date":null}
Calculated next_sub_ref: 10
Attempting to insert sub-incident...
Sub-incident created with ID: 102909
Error creating incident: fs is not defined
Stack: ReferenceError: fs is not defined
    at C:\Users\RogerioAMartins\.gemini\antigravity\scratch\NewProject.PIM\server\routes\incidents.js:294:13
    at process.processTicksAndRejections (node:internal/process/task_queues:103:5)
Creating sub-incident. Ref: 0661/25, Next Sub-Ref: 1
Creating sub-incident. Ref: 0661/2025, Next Sub-Ref: 11
Creating sub-incident. Ref: 0661/2025, Next Sub-Ref: 12
